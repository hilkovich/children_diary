from aiogram import Router
from aiogram.types import Message
from aiogram.fsm.context import FSMContext
from aiogram.filters.command import Command

from utils.states import ProcessImageStates
from keyboards.history import kb_new_history, kb_help
from keyboards.books import kb_download_book
from queries.users import add_new_user, get_user
from queries.books import get_all_book

router = Router()


@router.message(Command("start"))
async def cmd_start(message: Message):
    user = get_user(message.from_user.id)
    if user is None:
        add_new_user(message.from_user.id)
    msg = (
        "–ü—Ä–∏–≤–µ—Ç üëã\n"
        "–Ø ‚Äî –±–æ—Ç–∏–∫, —É–º–µ—é —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ –≤–µ—Å—Ç–∏ –∫–Ω–∏–≥–∏ —Å –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π —Ä–µ–±–µ–Ω–∫–∞.\n\n"
        "–í—ã —Å–º–æ–∂–µ—Ç–µ:\n"
        "‚û§  —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∫–Ω–∏–≥–∏ –ø–æ–¥ —Ä–∞–∑–Ω—ã–µ –≤–∞–∂–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –∏ –¥–∞—Ç—ã —Ä–µ–±–µ–Ω–∫–∞;\n"
        "‚û§  –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ —Ä–µ–±–µ–Ω–∫–∞, —Å–¥–µ–ª–∞–Ω–Ω—ã–µ –≤ —Ä–∞–∑–Ω—ã–µ –ø–µ—Ä–∏–æ–¥—ã –µ–≥–æ –∂–∏–∑–Ω–∏;\n"
        "‚û§  –¥–æ–±–∞–≤–ª—è—Ç—å —Ç–µ–∫—Å—Ç –∫ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º, –æ–ø–∏—Å—ã–≤–∞—è —Å–æ–±—ã—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞ –Ω–∏—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω—ã, –∏–ª–∏ —á—É–≤—Å—Ç–≤–∞ –∏ —ç–º–æ—Ü–∏–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —ç—Ç–∏–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏;\n"
        "‚û§  —Å –ø–æ–º–æ—â—å—é –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ —ç—Ç–æ—Ç –º–∞—Ç–µ—Ä–∏–∞–ª –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤ –≥–ª–∞–≤—É –∫–Ω–∏–≥–∏;\n"
        "‚û§  –¥–æ–±–∞–≤–ª—è—Ç—å –≥–ª–∞–≤—É –≤ —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∫–Ω–∏–≥–∏;\n"
        "‚û§  —Å–∫–∞—á–∏–≤–∞—Ç—å –∫–Ω–∏–≥–∏, —á—Ç–æ–±—ã —Ä–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å –∏—Ö –∏–ª–∏ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è;\n"
        "‚û§  –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫–Ω–∏–≥–∏ –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏ –∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä—ã."
    )
    await message.answer(msg, reply_markup=kb_help())


@router.message(Command("new"))
async def cmn_add_new_history(message: Message, state: FSMContext):
    await message.answer(
        "‚û§ –°–ø–µ—Ä–≤–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ 20 –¥–µ—Ç—Å–∫–∏—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ"
    )
    await message.answer(
        "‚û§ –ó–∞—Ç–µ–º –æ–ø–∏—à–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞ –Ω–∏—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç. –ü—Ä–∏–º–µ—Ä: –°–µ–º–µ–π–Ω–∞—è –ø—Ä–æ–≥—É–ª–∫–∞ –ø–æ –ø–∞—Ä–∫—É –≤–æ–∑–ª–µ –¥–æ–º–∞ —Å –ø–∏–∫–Ω–∏–∫–æ–º —Å –±–∞–±—É—à–∫–æ–π –∏ –¥–µ—Ç—å–º–∏ –ü–æ–ª–∏–Ω–æ–π 2 –≥–æ–¥–∞ –∏ –ú–∞–∫—Å–∏–º–æ–º 7 –ª–µ—Ç."
    )
    await state.update_data(photo_file_id=[])
    await state.set_state(ProcessImageStates.addImage)


@router.message(Command("books"))
async def cmn_get_all_book(message: Message):
    books = get_all_book(message.from_user.id)
    await message.answer(f"–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–Ω–∏–≥–∏:\n{books}", reply_markup=kb_download_book())


@router.message(Command("help"))
async def cmn_help_use(message: Message):
    msg = (
        "–°–æ–∑–¥–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏\n"
        "‚û§ –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∏—Å—Ç–æ—Ä–∏–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –º–µ–Ω—é –∏–ª–∏ –∫–Ω–æ–ø–∫–æ–π —Å–æ–∑–¥–∞–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏\n"
        "‚û§ –°–ø–µ—Ä–≤–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –æ—Ç 2 –¥–æ 5 –¥–µ—Ç—Å–∫–∏—Ö —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –≤ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –¥–Ω—è\n"
        "‚û§ –ù–∞ —ç—Ç–∞–ø–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –Ω–µ —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –æ–ø–∏—Å–∞–Ω–∏—è!\n"
        "‚û§ –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –æ–ø–∏—à–∏—Ç–µ —Å–æ–±—ã—Ç–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞ –Ω–∏—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç\n"
        "‚û§ –û–ø–∏—Å–∞–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≥–ª–∞–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç —É—á–µ—Å—Ç—å –ø—Ä–∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ –∏—Å—Ç–æ—Ä–∏–∏\n\n"
        "–î–æ–ø —Ñ—É–Ω–∫—Ü–∏–∏\n"
        "‚û§ –°–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–∏–≥ –ø–æ–¥ –∑–Ω–∞—á–∏–º—ã–µ –º–æ–º–µ—Ç—ã –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –Ω–∏—Ö –∏—Å—Ç–æ—Ä–∏–π\n"
        "‚û§ –î–ª—è –ø–æ–≤—Ç–æ—Ä–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –±–æ—Ç–∏–∫–∞ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –º–µ–Ω—é\n"
        "‚û§ –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –∫–Ω–∏–≥ –∏ –∏—Ö —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –º–µ–Ω—é"
    )
    await message.answer(msg, reply_markup=kb_new_history())
