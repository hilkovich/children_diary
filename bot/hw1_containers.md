# Контейнеризация и оркестрация: ЛР 1 - Dockerfile
### Требования:
- Написать “плохой” Dockerfile в котором есть не менее 3 “bad practices” при этом Dockerfile должен запускаться и работать корректно
- Написать “хороший” Dockerfile в котором эти плохие практики исправлены
- Описать все плохие практики в “плохом” Dockerfile, почему они плохие, как они были исправлены в хорошем Dockerfile
- Описать 2 плохих практики по использованию контейнера
- Написать два случая, когда НЕ стоит использовать контейнеры в целом
- Монтирование volume в контейнере - обязательно

## Плохой Dockerfile
```
# Отсутствие фиксации версии Python
FROM python:latest

WORKDIR /bot

COPY requirements.txt /bot

# Отсутствие группировки команд
pip install --upgrade pip
pip install -r /bot/requirements.txt

VOLUME /children_diary/data_bot

EXPOSE 8080

# Использование абсолютного пути
COPY ./ /bot

CMD ["python", "app.py"]
```
## Исправленный Dockerfile
```
# Используем версию в которой работали локально
FROM python:3.12

WORKDIR /bot

COPY requirements.txt /bot

# Группируем команды
RUN pip install --upgrade pip && pip install -r /bot/requirements.txt

VOLUME /children_diary/data_bot

EXPOSE 8080

# Изменяем путь
COPY . /bot

CMD ["python", "app.py"]
```
## Описание плохих практик и их исправлений
1. **Использование большого базового образа**

   Использование тега latest означает, что мы полагаемся на самую последнюю версию базового образа, которая может измениться в любой момент. Мы не можем точно знать, какая версия кода работает в контейнере. Это затрудняет отслеживание и откат к предыдущим версиям кода. Неконтролируемое изменение версии может включать изменения, несовместимые с нашим приложением, а это может привести к сбоям в работе.

2. **Отсутствие группировки команд**

   Каждая команда создает отдельный слой. Если не группировать их, это приведет к увеличению размера и снижению производительности контейнеров. В данном случае мы используем одну команду RUN для объединения слоев.

2. **Использование абсолютного пути**

   Использование . в качестве источника указывает на текущий каталог, что делает команду более понятной и читаемой. Это помогает легче понять, что именно копируется. Позволяет избежать необходимости явно указывать текущий каталог. Является более стандартным и поддерживается всеми версиями Docker, что обеспечивает лучшую обратную совместимость.
## Плохие практики по использованию контейнера
1. **Запуск контейнеров без ограничения ресурсов**

Если при запуске контейнера не указать ограничения, существует риск использования всех ресурсов процессора и памяти машины. Это может привести к сбоям в работе других программ и контейнеров. Поэтому важно явно прописывать ограничения при запуске.
2. **Не очищать неиспользуемые образы и контейнеры**

После частых развертываний остаются остановленные контейнеры. Если они не понадобятся в будущем, они будут только занимать место на машине. Кроме того, ориентироваться в большом объеме данных (особенно если неясно, нужны они или нет) будет сложнее. Поэтому рекомендуется периодически очищать неиспользуемые контейнеры.

## Когда НЕ стоит использовать контейнеры в целом
1. **Небольшие и простые приложения**

Если есть небольшое и простое приложение, которое не требует сложной настройки или масштабирования, использование контейнеров может быть излишним. В таких случаях проще и эффективнее использовать традиционные методы развертывания.

2. **Приложения с высокой степенью безопасности**

Если приложение требует высокого уровня безопасности и изоляции, использование контейнеров может не обеспечить достаточную защиту. В некоторых случаях, особенно для приложений с высокими требованиями к безопасности, использование виртуальных машин может быть более предпочтительным.
